# Lumen Language Schema (YAML)
# Pure declarative data for the Lumen language
# All parsing and execution is handled by the microcode kernel

name: lumen
version: 1.0

# LEXICAL RULES
# =============

keywords:
  - if
  - else
  - while
  - print
  - and
  - or
  - not
  - true
  - false
  - break
  - continue
  - extern

# Multi-character lexemes (sorted by length descending for maximal-munch)
multichar_lexemes:
  - "=="
  - "!="
  - "<="
  - ">="
  - ":="

# Characters that split tokens (whitespace, punctuation)
split_chars:
  - " "
  - "\t"
  - "\n"
  - "("
  - ")"
  - "{"
  - "}"
  - "["
  - "]"
  - ","
  - ";"
  - ":"

# STRUCTURAL RULES
# ================

structure:
  # Indentation mode: "fixed" (Python-like) or "none" (C-like with braces)
  indentation: fixed
  indent_size: 4

  # Newline behavior: "terminator" (ends statement) or "ignored" (just whitespace)
  newline_behavior: terminator

  # EOF handling
  eof_handling: insert_newline

  # Block delimiters
  block_open: "{"
  block_close: "}"

  # Statement terminators
  statement_terminators:
    - "\n"
    - ";"

# OPERATORS
# =========

operators:
  # Binary operators
  binary:
    # Arithmetic (precedence 5)
    "+":
      precedence: 5
      associativity: left
      name: addition
    "-":
      precedence: 5
      associativity: left
      name: subtraction
    "*":
      precedence: 6
      associativity: left
      name: multiplication
    "/":
      precedence: 6
      associativity: left
      name: division
    "%":
      precedence: 6
      associativity: left
      name: modulo

    # Comparison (precedence 4)
    "==":
      precedence: 4
      associativity: left
      name: equal
    "!=":
      precedence: 4
      associativity: left
      name: not_equal
    "<":
      precedence: 4
      associativity: left
      name: less_than
    ">":
      precedence: 4
      associativity: left
      name: greater_than
    "<=":
      precedence: 4
      associativity: left
      name: less_equal
    ">=":
      precedence: 4
      associativity: left
      name: greater_equal

    # Logical (precedence 2-3)
    "and":
      precedence: 3
      associativity: left
      name: logical_and
    "or":
      precedence: 2
      associativity: left
      name: logical_or

    # Assignment (precedence 1)
    "=":
      precedence: 1
      associativity: right
      name: assign

  # Unary operators
  unary:
    "not":
      precedence: 7
      position: prefix
      name: logical_not
    "-":
      precedence: 7
      position: prefix
      name: negate

# STATEMENTS
# ==========

statements:
  print:
    description: "Print expression to output"
    pattern: [keyword, "(", expression, ")"]
    fields:
      - keyword: print
      - lparen: "("
      - expression: value
      - rparen: ")"
    primitive: print_stmt

  assignment:
    description: "Assign value to variable"
    pattern: [identifier, "=", expression]
    fields:
      - variable: name
      - operator: "="
      - value: expression
    primitive: assign

  if_statement:
    description: "If-then-else conditional"
    pattern: [keyword, expression, block, optional(keyword, block)]
    fields:
      - keyword: if
      - condition: expression
      - then_block: block
      - else_keyword: else
      - else_block: block
    primitive: conditional

  while_loop:
    description: "While loop"
    pattern: [keyword, expression, block]
    fields:
      - keyword: while
      - condition: expression
      - body: block
    primitive: loop

  break_statement:
    description: "Break from loop"
    pattern: [keyword]
    fields:
      - keyword: break
    primitive: jump

  continue_statement:
    description: "Continue loop iteration"
    pattern: [keyword]
    fields:
      - keyword: continue
    primitive: jump

  extern_call:
    description: "Call external capability"
    pattern: [keyword, identifier, ":", identifier, "(", args, ")"]
    fields:
      - keyword: extern
      - module: identifier
      - selector: identifier
      - args: expression_list
    primitive: call

# EXTERN CALLS
# ============

extern:
  keyword: extern
  # Syntax: extern module:capability(arg1, arg2)
  selector_start: " "
  selector_separator: ":"
  args_open: "("
  args_close: ")"
  arg_separator: ","

  # Built-in capabilities (examples)
  capabilities:
    print:
      arity: 1
      description: "Print value"
    input:
      arity: 0
      description: "Read line from input"

# EXPRESSION TYPES
# ================

expressions:
  literal:
    - number: "0-9, including decimals"
    - string: "\"...\""
    - boolean: "true, false"

  identifier:
    - pattern: "[a-zA-Z_][a-zA-Z0-9_]*"
    - description: "Variable name"

  grouping:
    - open: "("
    - close: ")"
    - content: "expression"

  binary_operation:
    - left: "expression"
    - operator: "binary_op"
    - right: "expression"

  unary_operation:
    - operator: "unary_op"
    - operand: "expression"

# VALUE TYPES
# ===========

values:
  number:
    description: "Floating-point number"
    display: "64-bit IEEE 754 float"

  string:
    description: "Text string"
    display: "UTF-8 encoded text"

  boolean:
    description: "True or false"
    display: "true or false"

  null:
    description: "Null/void value"
    display: "null"
