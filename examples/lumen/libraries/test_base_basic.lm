# Basic tests for numeric_to_base_string() library function

# ------------------------------------------------------------
# Base conversion library
# ------------------------------------------------------------

alphabet = "0123456789abcdefghijklmnopqrstuvwxyz"

fn numeric_to_base_string(value, radix)
    if kind(radix) != kind(0)
        error("numeric_to_base_string(): radix must be INTEGER")

    if radix < 2 or radix > 36
        error("numeric_to_base_string(): radix must be between 2 and 36")

    k = kind(value)

    if k == kind(0)
        return integer_to_base_string(value, radix)

    if k == kind(1/2)
        return rational_to_base_string(value, radix)

    if k == kind(1.0)
        return real_to_base_string(value, radix)

    error("numeric_to_base_string(): unsupported kind")

fn integer_to_base_string(n, radix)
    if n == 0
        return "0"

    negative = false
    if n < 0
        negative = true
        n = -n

    result = ""

    while n > 0
        digit = n % radix
        result = char_at(alphabet, digit) . result
        n = n // radix

    if negative
        result = "-" . result

    result

fn rational_to_base_string(r, radix)
    n = num(r)
    d = den(r)

    n_str = integer_to_base_string(n, radix)
    d_str = integer_to_base_string(d, radix)

    n_str . "/" . d_str

fn real_to_base_string(x, radix)
    i = int(x)
    f = frac(x)

    int_part = integer_to_base_string(i, radix)

    if f == real_default(0)
        return int_part

    frac_part = base_frac(f, radix, 16)

    int_part . "." . frac_part

fn base_frac(f, radix, limit)
    result = ""
    count = 0

    while count < limit
        if f == real_default(0)
            return result

        f = f * real_default(radix)
        digit = int(f)
        result = result . char_at(alphabet, digit)
        f = frac(f)
        count = count + 1

    result

# ------------------------------------------------------------
# Tests
# ------------------------------------------------------------

print("=== Basic Base Conversion Tests ===")
print("")

# Test 1: INTEGER to various bases
print("Test 1: INTEGER conversions")
n = 255

write("Decimal 255 in binary: ")
print(numeric_to_base_string(n, 2))

write("Decimal 255 in octal: ")
print(numeric_to_base_string(n, 8))

write("Decimal 255 in hexadecimal: ")
print(numeric_to_base_string(n, 16))

write("Decimal 255 in base 36: ")
print(numeric_to_base_string(n, 36))

print("")

# Test 2: RATIONAL conversions
print("Test 2: RATIONAL conversions")
r = 22/7

write("22/7 in decimal: ")
print(numeric_to_base_string(r, 10))

write("22/7 in binary: ")
print(numeric_to_base_string(r, 2))

write("22/7 in hexadecimal: ")
print(numeric_to_base_string(r, 16))

print("")

# Test 3: REAL conversions
print("Test 3: REAL conversions")
x = 3.14159

write("3.14159 in decimal: ")
print(numeric_to_base_string(x, 10))

write("3.14159 in binary: ")
print(numeric_to_base_string(x, 2))

write("3.14159 in hexadecimal: ")
print(numeric_to_base_string(x, 16))

print("")

# Test 4: Negative numbers
print("Test 4: Negative numbers")
write("-42 in binary: ")
print(numeric_to_base_string(-42, 2))

write("-42 in hexadecimal: ")
print(numeric_to_base_string(-42, 16))

print("")

# Test 5: Zero
print("Test 5: Zero")
write("0 in binary: ")
print(numeric_to_base_string(0, 2))

write("0 in hexadecimal: ")
print(numeric_to_base_string(0, 16))

print("")

# Test 6: Powers of 2
print("Test 6: Powers of 2")
write("1024 in binary: ")
print(numeric_to_base_string(1024, 2))

write("1024 in octal: ")
print(numeric_to_base_string(1024, 8))

write("1024 in hex: ")
print(numeric_to_base_string(1024, 16))

print("")
print("Done!")
